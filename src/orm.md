# 对象关系映射

## EF(Entity Framework)是什么？

实体框架EF是http://ADO.NET中的一组支持开发面向数据的软件应用程序的技术，是微软的一个ORM框架。

主要有三种方式：

Database FirstDatabase First”模式，我们称之为“数据库优先”，前提是你的应用已经有相应的数据库，你可以使用EF设计工具根据数据库生成数据数据类，你可以使用Visual Studio模型设计器修改这些模型之间对应关系。

Model FirstModel First我们称之为“模型优先”，这里的模型指的是“ADO.NET Entity Framework Data Model”，此时你的应用并没有设计相关数据库，在Visual Studio中我们通过设计对于的数据模型来生成数据库和数据类。

Code FirstCode First模式我们称之为“代码优先”模式，是从EF4.1开始新建加入的功能。使用Code First模式进行EF开发时开发人员只需要编写对应的数据类（其实就是领域模型的实现过程），然后自动生成数据库。这样设计的好处在于我们可以针对概念模型进行所有数据操作而不必关心数据的存储关系，使我们可以更加自然的采用面向对象的方式进行面向数据的应用程序开发。

## 什么是ORM?

ORM指的是面向对象的对象模型和关系型数据库的数据结构之间的互相转换。(表实体跟表之间的相互转换)

ORM框架有很多，EF框架是ORM框架的其中一种，是实现了ORM思想的框架。

O=>表实体、M=>映射关系、R=>数据库.表

## 为什么用EF而不用原生的ADO.NET?

1. 极大的提高开发效率:EF是微软自己的产品,开发中代码都是强类型的,写代码效率非常高,自动化程度非常高,命令式的编程.
2. EF提供的模型设计器非常强大,不仅仅带来了设计数据库的革命,也附带来的自动化模型代码的功能也极大的提高开发和架构设计的效率.
3. EF跨数据支持的是ORM框架主要功能点之一,带来的是可以通过仅仅改变配置就可以做到跨数据库的能力

## 如何提高LINQ性能问题？

提升从数据库中拿数据的速度，可以参考以下几种方法：

1. 在数据库中的表中定义合适的索引和键
2. 只获得你需要的列（使用ViewModel或者改进你的查询）和行（使用IQueryable）
3. 尽可能使用一条查询而不是多条
4. 只为了展示数据，而不进行后续修改时，可以使用AsNoTracking。它不会影响生成的SQL，但它可以令系统少维护很多数据，从而提高性能
5. 使用Reshaper等工具，它可能会在你写出较差的代码时给出提醒

## 除了EF，列举出你知道的ORM框架？

dapper、EntityFramework、 EJB、Hibernate、IBATIS、TopLink、OJB

## 如何如何获取EF生成的Sql脚本？

1. 可以调试起来通过SqlServerProfiler 来获取Sql
2. EF Dbcontext 注册日志事件输出日志查看Sql

## 在哪些类型额项目中你会选择EF? 为什么？

这个要结合EF的特点来说：EF主要是以面向对象的思想来做数据库数据操作，对Sql语句能力没什么要求，开发使用效率高！便于上手，一般来说，使用EF框架，肯定会比直接使用ADO.NET，消耗的时间多一些。 所以在一般企业级开发，管理型系统，对数据性能要求不是特别高的情况下，优先选择EF,这样可以大大的推进开发效率！如果像一些互联网项目中，对性能要求精度很高！可以另外做技术选型，选择原生ADO.NET。

## 请说明EF中映射实体对象的几种状态？

- Detached：该实体未由上下文跟踪。刚使用新运算符或某个 System.Data.Entity.DbSet Create 方法创建实体后，实体就处于此状态。
- Unchanged：实体将由上下文跟踪并存在于数据库中，其属性值与数据库中的值相同。
- Added：实体将由上下文跟踪，但是在数据库中还不存在。
- Deleted：实体将由上下文跟踪并存在于数据库中，但是已被标记为在下次调用 SaveChanges 时从数据库中删除。
- Modified：实体将由上下文跟踪并存在于数据库中，已修改其中的一些或所有属性值。

## 如果实体名称和数据库表名不一致，该如何处理？

实体名称和数据库表名称不一致：可以通过使用TableAttribute 特性；

## DataReader与Dataset有什么区别？

一个是只能向前的只读游标，一个是内存中虚拟的数据库。

## ADO.NET中读写数据库需要使用哪些对象？作用是什么？

Connection连接对象，Command执行命令和存储过程，DataReader向前只读的数据流，DataAdapter适配器，支持增删查询，DataSet数据级对象，相当与内存里的一张或多张表。

## 什么是SQL注入，应该如何防止?

利用sql关键字对网站进行攻击,用参数化的SQL就可以避免SQL注入!

## ExecuteScalar 和 ExecuteNonQuery 的区别?

ExecuteNonQuery：返回受影响的行数。

ExecuteScalar：返回结果集的第一行第一列，忽略其他行。

## 何时创建连接池？

当第一个连接请求到来时创建连接池；连接池的建立由数据库连接的连接字符创来决定。每一个连接池都与一个不同的连接字符串相关。当一个新的连接请求到来时如果连接字符串和连接池使用的字符串相同，就从连接池取出一个连接；如果不相同，就新建一个连接池。

## 何时关闭连接池？

当连接池中的所有连接都已经关闭时关闭连接池。

## 当连接池中的连接都已经用完，而有新的连接请求到来时会发生什么？

当连接池已经达到它的最大连接数目时，有新的连接请求到来时，新的连接请求将放置到连接队列中。当有连接释放给连接池时，连接池将新释放的连接分配给在队列中排队的连接请求。你可以调用close和dispose将连接归还给连接池。

## 如何允许连接池？

对于.NET应用程序而言，默认为允许连接池。（这意味着你可以不必为这件事情做任何的事情）当然，如果你可以在SQLConnection对象的连接字符串中加进Pooling=true;确保你的应用程序允许连接池的使用。

## 应该如何禁止连接池？

ADO.NET默认为允许数据库连接池，如果你希望禁止连接池，可以使用如下的方式：

1. 使用SQLConnection对象时，往连接字符串加入如下内容：Pooling=False;
2. 使用OLEDBConnection对象时，往连接字符串加入如下内容：OLE DB Services=-4;

